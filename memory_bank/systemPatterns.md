# 系统模式 (System Patterns)

## 架构与技术栈

### 前端 (用户界面)
- **框架**: React 18
- **构建工具**: Vite
- **UI 库**: Ant Design 5.0
- **样式**: CSS Modules / 全局 CSS (`timeline.css`)
- **状态管理**: React Hooks (`useState`, `useEffect`)
- **时间处理**: `dayjs`

### 后端 (API & 逻辑)
- **服务器**: Flask (Python 3.8+)
- **API 风格**: RESTful
- **跨域支持**: `flask-cors` (允许所有源，适应本地使用环境)

### 数据层 (持久化)
- **存储**: 项目根目录 `data/` 下的本地 JSON 文件。
    - `projects.json`: 存储项目实体。
    - `productlines.json`: 存储产品线定义。
- **并发控制**: `file_handler.py` 中的文件锁机制，防止写入时的竞态条件。

## 关键设计模式

### 1. "启动脚本" 模式
系统严重依赖 `start.py` 作为编排器。它充当系统检查器、包管理器包装器和进程管理器。它确保在应用程序逻辑运行之前，环境是正确的。

### 2. 时间轴渲染算法
- **变量**: `pixelsPerDay` 决定时间轴的宽度。
- **网格生成**: 基于计算出的 `minDate` 和 `maxDate`（包含所有项目 + 留白）动态生成月份和周刻度。
- **定位**: 基于日期差计算绝对定位 (`left`, `width`) 来放置项目块。

### 3. 智能行分配 (贪心算法)
为了防止泳道内的视觉重叠：
1.  按开始日期对项目排序。
2.  遍历项目。
3.  对于每个项目，检查第 0 行。如果与第 0 行的现有项目重叠，则检查第 1 行，依此类推。
4.  分配第一个不冲突的行索引。

### 4. 数据兼容性
- **访问模式**: 使用 `.get('key', default)` 读取 JSON 数据字段。
- **目的**: 允许添加新字段（如 `remarks`）而不会破坏现有的数据文件或需要迁移脚本。

### 5. 部署分离
- **本地**: `start.py` 启动 Flask (5000) 和 Vite (5173)。
- **云端**: `scripts/deploy_cloud.sh` 处理 rsync 和服务重启。将"运行应用"与"发布应用"的关注点分离。

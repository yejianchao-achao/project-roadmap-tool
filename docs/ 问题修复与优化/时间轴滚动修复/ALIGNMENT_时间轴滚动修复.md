# 时间轴滚动修复 - 需求对齐文档

## 一、原始需求

用户反馈了两个时间轴滚动问题：
1. 时间轴头部（月份刻度）没有跟着看板内容一起滚动
2. 页面加载时没有默认滚动到当前时间附近

## 二、项目上下文分析

### 2.1 现有架构
- **组件结构**：
  - `TimelineView.jsx`：主容器组件，管理滚动同步
  - `TimelineHeader.jsx`：头部月份刻度组件
  - `timeline.css`：样式定义

- **滚动机制**：
  - 使用ref引用头部和内容区域
  - 通过scroll事件监听器同步scrollLeft
  - 初始化时计算并设置滚动位置

### 2.2 问题根因分析

**问题1根因**：
```css
.timeline-header {
  overflow: hidden;  /* 阻止了滚动显示 */
}
```
- CSS设置了`overflow: hidden`，即使JS设置了scrollLeft，视觉上也不会滚动
- 需要改为`overflow-x: auto`或`overflow-x: scroll`

**问题2根因**：
```javascript
useEffect(() => {
  // 初始化滚动逻辑
  setTimeout(() => {
    scrollContainer.scrollLeft = scrollLeft
  }, 100)
}, [timelineParams])  // 依赖项不够精确
```
- 依赖项只有timelineParams，但pixelsPerDay是异步计算的
- 100ms延迟可能不够，DOM可能还未完全渲染
- 需要更精确的依赖项和更可靠的时机

## 三、需求边界确认

### 3.1 修复范围
- ✅ 修复头部滚动同步问题
- ✅ 修复初始滚动定位问题
- ✅ 确保滚动体验流畅
- ❌ 不改变现有布局结构
- ❌ 不影响其他功能

### 3.2 技术约束
- 使用现有的React Hooks机制
- 保持CSS样式的简洁性
- 不引入新的依赖库
- 兼容现有的缩放功能

## 四、验收标准

### 4.1 功能验收
1. **头部滚动同步**：
   - 滚动内容区域时，头部月份刻度同步滚动
   - 滚动流畅无卡顿
   - 头部和内容完全对齐

2. **初始定位**：
   - 页面加载后自动滚动到当前月份
   - 当前月份显示在视口左侧1/4位置（更好的视觉体验）
   - 缩放后重新定位到当前月份

### 4.2 兼容性验证
- 不同窗口尺寸下正常工作
- 缩放功能不受影响
- 产品线筛选不受影响

## 五、疑问澄清

### Q1: 初始滚动位置应该在哪里？
**决策**：滚动到当前月份，并让当前月份显示在视口左侧1/4位置，这样用户可以看到：
- 当前月份之前的一些项目（左侧1/4）
- 当前月份及未来的项目（右侧3/4）

### Q2: 缩放后是否需要重新定位？
**决策**：是的，缩放改变了显示的月份数量，应该重新定位到当前月份，保持用户的时间参考点。

### Q3: 头部滚动条是否需要显示？
**决策**：不显示，保持界面简洁。头部只是被动跟随内容区域滚动。

## 六、实现方案概要

### 6.1 CSS修复
```css
.timeline-header {
  overflow-x: auto;  /* 允许水平滚动 */
  overflow-y: hidden;  /* 禁止垂直滚动 */
}

.timeline-header::-webkit-scrollbar {
  display: none;  /* 隐藏滚动条 */
}
```

### 6.2 JS修复
1. **改进滚动同步**：
   - 确保事件监听器正确绑定
   - 添加防抖优化（如果需要）

2. **改进初始定位**：
   - 使用更精确的依赖项
   - 增加延迟时间或使用requestAnimationFrame
   - 计算更合理的滚动位置（视口1/4位置）

3. **缩放后重新定位**：
   - 监听visibleMonths变化
   - 缩放后重新计算并滚动到当前月份

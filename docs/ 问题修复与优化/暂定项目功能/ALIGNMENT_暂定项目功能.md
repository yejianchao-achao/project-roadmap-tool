# 暂定项目功能 - 需求对齐文档

## 一、原始需求

用户提出以下需求：

1. 新建与编辑项目时，增加暂定选项，默认不勾选
2. 项目显示时（包括在进度看板与人员看板），若暂定的项目，则项目块的轮廓以虚线展示，填充规则以现有规则相同
3. 暂停项目的轮廓不需要以虚线展示

## 二、项目上下文分析

### 2.1 现有项目架构

**技术栈**：
- 后端：Python + Flask
- 前端：React + Ant Design
- 数据存储：JSON文件

**核心模块**：
- 后端模型：`backend/models/project.py` - 项目数据模型
- 前端组件：
  - `frontend/src/components/ProjectModal.jsx` - 项目表单
  - `frontend/src/components/Timeline/ProjectBar.jsx` - 项目块渲染
- 常量定义：`frontend/src/utils/constants.js`

### 2.2 现有项目状态系统

**项目状态列表**（7种）：
```python
VALID_STATUSES = ['规划', '方案', '设计', '开发', '测试', '已上', '暂停']
```

**状态颜色映射**：
- 规划: 浅蓝色
- 方案: 蓝色
- 设计: 绿色
- 开发: 橙色
- 测试: 黄色
- 已上: 深红色
- 暂停: 灰色（虚线边框）

### 2.3 现有暂停状态处理

在 `ProjectBar.jsx` 中已经实现了暂停状态的虚线边框：

```javascript
// 暂停状态使用虚线边框
const isPaused = project.status === '暂停'

<div
  className={`project-bar ${isPaused ? 'project-bar-paused' : ''}`}
  style={{
    backgroundColor: isPaused ? '#f5f5f5' : color,
    borderColor: color,
    borderStyle: isPaused ? 'dashed' : 'solid'
  }}
>
```

### 2.4 看板类型

系统支持两种看板类型：
1. **进度看板**（STATUS）：按项目状态分组，使用状态颜色
2. **人员看板**（OWNER）：按负责人分组，使用人员颜色

## 三、需求理解与分析

### 3.1 核心需求拆解

#### 需求1：增加暂定选项
- **位置**：项目表单（新建/编辑）
- **形式**：复选框（Checkbox）
- **默认值**：不勾选（false）
- **字段名**：`isPending`（建议）
- **数据类型**：布尔值

#### 需求2：暂定项目的视觉展示
- **适用范围**：所有看板（进度看板 + 人员看板）
- **视觉效果**：
  - 轮廓：虚线边框
  - 填充：保持现有规则（状态颜色或人员颜色）
- **实现方式**：类似暂停状态的处理逻辑

#### 需求3：暂停项目保持实线
- **明确要求**：暂停状态不使用虚线边框
- **冲突处理**：需要修改现有暂停状态的虚线逻辑

### 3.2 需求澄清

#### 问题1：暂定与暂停的关系
**分析**：
- **暂停**：项目状态之一，表示项目暂时停止
- **暂定**：项目属性，表示项目计划尚未确定

**结论**：
- 暂定和暂停是两个独立的维度
- 一个项目可以同时是"暂定"且状态为"暂停"
- 视觉优先级：暂定（虚线）> 暂停（实线）

#### 问题2：虚线边框的优先级
**场景分析**：
- 场景A：项目是暂定的，状态为开发 → 虚线边框 + 开发颜色填充
- 场景B：项目是暂定的，状态为暂停 → 虚线边框 + 灰色填充
- 场景C：项目不是暂定的，状态为暂停 → 实线边框 + 灰色填充

**结论**：
- 只要项目是暂定的，就使用虚线边框
- 暂停状态不再自动使用虚线边框
- 填充颜色按现有规则（状态或人员）

#### 问题3：数据迁移
**现有数据**：
- 所有现有项目都没有 `isPending` 字段

**处理方案**：
- 后端读取时，如果字段不存在，默认为 `false`
- 不需要数据迁移脚本，兼容性处理即可

## 四、边界确认

### 4.1 功能范围

**包含**：
- ✅ 后端模型增加 `isPending` 字段
- ✅ 前端表单增加暂定复选框
- ✅ 前端项目块根据 `isPending` 显示虚线边框
- ✅ 修改暂停状态的虚线逻辑（改为实线）
- ✅ 两种看板都支持暂定项目的虚线显示

**不包含**：
- ❌ 暂定项目的筛选功能
- ❌ 暂定项目的统计功能
- ❌ 暂定项目的批量操作
- ❌ 数据迁移脚本

### 4.2 技术约束

- 保持现有架构不变
- 兼容现有数据（旧数据没有 `isPending` 字段）
- 不影响现有功能
- 代码风格与现有代码保持一致

### 4.3 验收标准

1. **后端验证**：
   - 项目模型包含 `isPending` 字段
   - 字段验证正确（布尔值）
   - API 正确处理该字段
   - 旧数据兼容（默认 false）

2. **前端表单**：
   - 新建项目时显示暂定复选框，默认不勾选
   - 编辑项目时显示暂定复选框，正确回显
   - 表单提交包含 `isPending` 字段

3. **视觉展示**：
   - 暂定项目在进度看板显示虚线边框
   - 暂定项目在人员看板显示虚线边框
   - 暂定项目的填充颜色按现有规则
   - 暂停状态项目显示实线边框（不再是虚线）
   - 暂定且暂停的项目显示虚线边框

4. **兼容性**：
   - 现有项目正常显示（默认不暂定）
   - 不影响其他功能

## 五、疑问与假设

### 5.1 已确认的假设

1. **字段命名**：使用 `isPending` 作为字段名
2. **默认值**：新项目默认不暂定（false）
3. **视觉优先级**：暂定优先于暂停
4. **兼容性**：旧数据默认为 false

### 5.2 需要确认的问题

**无需确认**，需求已经足够明确，可以直接进入设计阶段。

## 六、下一步行动

1. 创建 CONSENSUS 文档，明确技术实现方案
2. 创建 DESIGN 文档，设计系统架构
3. 创建 TASK 文档，拆分原子任务
4. 等待人工审批后开始实施

## 七、文档版本

- **创建时间**：2025-10-20
- **创建人**：Cline AI
- **版本**：v1.0
- **状态**：待审核

# ALIGNMENT - 单月宽度设置功能需求对齐

## 📋 原始需求

**需求描述**：
进度看板与人员看板中，增加单月的宽度的设置功能：用户可以增加或者缩小单月宽度，设置后下次仍然记住之前的设置

**需求来源**：用户反馈  
**创建时间**：2025-10-21 09:33

## 🎯 需求理解

### 核心诉求
1. **单月宽度调整**：用户希望能够自由调整时间轴中单个月份的显示宽度
2. **适用范围**：进度看板和人员看板都需要支持此功能
3. **持久化设置**：用户的宽度设置需要保存，下次打开时自动恢复

### 当前实现分析

#### 现有时间轴宽度计算机制
从 `TimelineView.jsx` 代码分析：
```javascript
// 当前实现：固定 pixelsPerDay = 5
const pixelsPerDay = 5 // 固定值，每天5像素
const totalWidth = params.totalDays * pixelsPerDay
```

**问题**：
- pixelsPerDay 是硬编码的固定值（5像素/天）
- 单月宽度 = 30天 × 5像素 = 150像素（固定）
- 用户无法调整

#### 现有设置功能
从 `TimelineSettings.jsx` 分析：
- ✅ 已有时间范围设置（快捷选项 + 自定义）
- ✅ 已有缩放控制（visibleMonths：3-24个月）
- ❌ 缺少单月宽度调整功能

**现有缩放功能的局限**：
- `visibleMonths` 控制的是"视口显示多少个月"
- 但不影响单个月份的实际宽度
- 只是改变了可见范围，没有改变显示密度

## 🔍 需求边界确认

### 功能范围

#### 包含的功能
1. **宽度调整控件**
   - 在 TimelineSettings 组件中添加单月宽度调整器
   - 支持增加/减少单月宽度
   - 显示当前宽度值

2. **宽度范围限制**
   - 最小宽度：保证可读性（建议 100px）
   - 最大宽度：避免过度拉伸（建议 500px）
   - 默认宽度：150px（30天 × 5像素）

3. **持久化存储**
   - 使用 localStorage 保存设置
   - 页面刷新后自动恢复
   - 存储键名：`timeline_month_width`

4. **实时生效**
   - 调整后立即更新时间轴显示
   - 保持当前滚动位置（相对位置）
   - 平滑过渡效果

#### 不包含的功能
1. ❌ 不支持按周或按天调整宽度
2. ❌ 不支持不同产品线使用不同宽度
3. ❌ 不支持预设宽度模板
4. ❌ 日历看板不受影响（日历有自己的布局逻辑）

### 技术约束

#### 现有架构对齐
1. **计算逻辑位置**
   - `TimelineView.jsx`：主视图组件，负责计算 pixelsPerDay
   - `dateUtils.js`：日期工具函数，可能需要扩展
   - `TimelineSettings.jsx`：设置组件，添加宽度控件

2. **数据流向**
   ```
   TimelineSettings (用户调整)
        ↓
   App.jsx (状态管理)
        ↓
   TimelineView (应用宽度)
        ↓
   TimelineHeader + TimelineGrid + ProjectBar (渲染)
   ```

3. **存储策略**
   - 使用 localStorage（与现有设置保持一致）
   - 存储格式：`{ monthWidth: 150 }` (单位：像素)
   - 读取时机：App.jsx 初始化时

#### 兼容性考虑
1. **与现有缩放功能的关系**
   - `visibleMonths`：控制视口显示月数（保持不变）
   - `monthWidth`：控制单月实际宽度（新增）
   - 两者独立工作，互不影响

2. **与时间范围设置的关系**
   - 时间范围决定总天数
   - 单月宽度决定显示密度
   - totalWidth = totalDays × (monthWidth / 30)

3. **滚动位置保持**
   - 调整宽度时，保持当前日期在视口中的相对位置
   - 避免用户迷失当前查看位置

## ❓ 疑问澄清

### 需要确认的问题

#### Q1: 宽度调整的粒度
**问题**：单月宽度调整的步长应该是多少？
**选项**：
- A. 10px 步长（粗调，快速）
- B. 5px 步长（细调，精确）
- C. 滑块连续调整（最灵活）

**建议**：使用滑块连续调整（选项C），范围 100-500px，提供最佳用户体验

#### Q2: 默认宽度值
**问题**：默认的单月宽度应该是多少？
**当前实现**：150px（30天 × 5像素/天）
**建议**：保持 150px 作为默认值，这是经过测试的合理值

#### Q3: 宽度调整后的滚动行为
**问题**：调整宽度后，时间轴应该如何定位？
**选项**：
- A. 保持滚动像素位置不变
- B. 保持当前日期在视口中的相对位置
- C. 重新定位到当前日期

**建议**：选项B，保持当前日期在视口中的相对位置，用户体验最好

#### Q4: 是否需要重置按钮
**问题**：是否需要提供"重置为默认宽度"的按钮？
**建议**：需要，方便用户快速恢复到默认状态

## 📊 项目特性规范

### 技术栈对齐
- **前端框架**：React 18.2.0
- **UI组件库**：Ant Design 5.12.0
- **状态管理**：React useState + localStorage
- **日期处理**：dayjs 1.11.10

### 代码规范对齐
- 所有函数必须包含完整的 JSDoc 注释
- 使用 useCallback 优化回调函数
- 使用 useEffect 处理副作用
- 遵循现有的命名约定和文件结构

### 用户体验对齐
- 调整后立即生效，无需点击"应用"按钮
- 提供视觉反馈（当前宽度值显示）
- 平滑的过渡动画
- 清晰的操作提示

## 🎨 UI/UX 设计方向

### 控件位置
- 添加到 TimelineSettings 组件中
- 位于缩放控制下方
- 使用 Card 分组，标题"单月宽度"

### 控件样式
```
单月宽度
[━━━━●━━━━━━] 150px
[重置]
```

- 使用 Ant Design Slider 组件
- 显示当前宽度值（实时更新）
- 重置按钮（恢复默认值）

### 交互反馈
- 拖动滑块时，实时更新宽度值显示
- 释放滑块后，立即应用到时间轴
- 显示 Toast 提示："单月宽度已更新"

## 📝 验收标准

### 功能验收
1. ✅ 用户可以通过滑块调整单月宽度（100-500px）
2. ✅ 调整后时间轴立即更新显示
3. ✅ 设置自动保存到 localStorage
4. ✅ 页面刷新后设置自动恢复
5. ✅ 重置按钮可恢复默认宽度（150px）
6. ✅ 进度看板和人员看板都支持此功能
7. ✅ 调整宽度时保持当前查看位置

### 技术验收
1. ✅ 代码包含完整注释
2. ✅ 使用 React Hooks 最佳实践
3. ✅ 性能优化（防抖、useCallback）
4. ✅ 与现有功能无冲突
5. ✅ localStorage 读写正常

### 用户体验验收
1. ✅ 操作流畅，无卡顿
2. ✅ 视觉反馈清晰
3. ✅ 错误处理完善
4. ✅ 移动端适配良好

## 🔄 与现有功能的关系

### 影响的组件
1. **TimelineSettings.jsx** - 添加宽度调整控件
2. **TimelineView.jsx** - 接收并应用宽度设置
3. **App.jsx** - 管理宽度状态和持久化
4. **storageUtils.js** - 可能需要添加存储工具函数

### 不影响的功能
1. ✅ 日历看板（独立布局）
2. ✅ 产品线设置
3. ✅ 人员管理
4. ✅ 项目CRUD操作
5. ✅ 时间范围设置（独立功能）

## 📅 时间估算

### 开发工作量
- **需求对齐**：30分钟 ✅
- **架构设计**：30分钟
- **任务拆分**：20分钟
- **开发实现**：2小时
- **测试验证**：30分钟
- **文档编写**：30分钟

**总计**：约4小时

## ✅ 对齐确认

### 需求明确性
- ✅ 功能边界清晰
- ✅ 技术方案可行
- ✅ 验收标准明确
- ⚠️ 需要用户确认3个设计问题（Q1-Q3）

### 下一步行动
1. 等待用户确认设计问题
2. 进入 Architect 阶段（架构设计）
3. 生成 CONSENSUS 文档

---

**文档状态**：✅ 已完成  
**创建时间**：2025-10-21 09:33  
**最后更新**：2025-10-21 09:33

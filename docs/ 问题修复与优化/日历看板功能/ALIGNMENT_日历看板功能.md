# 日历看板功能 - 需求对齐文档

## 一、原始需求

用户需求：
```
增加一个日历看板功能：
1. 展示月日期，可以切换月份，默认为当前月
2. 按照项目的结束时间，在对应日期下显示项目名称，表示项目在当天上线
```

## 二、项目上下文分析

### 2.1 现有项目架构

**技术栈**：
- 前端：React 18.2.0 + Ant Design 5.12.0 + Vite
- 后端：Flask 3.0.0 + Python 3.8+
- 数据存储：JSON文件

**核心组件**：
- `App.jsx` - 主应用组件，管理全局状态
- `TimelineView.jsx` - 时间轴视图（现有的甘特图展示）
- `ProjectModal.jsx` - 项目创建/编辑表单
- `ProductLineSettings.jsx` - 产品线设置面板

**数据模型**：
- `Project` - 项目模型，包含字段：
  - id, name, productLineId, ownerId
  - startDate, endDate（YYYY-MM-DD格式）
  - status（规划/方案/设计/开发/测试/已上/暂停）
  - isPending（是否暂定）
  - createdAt, updatedAt

**现有功能**：
- ✅ 时间轴甘特图展示（按产品线或负责人分组）
- ✅ 项目CRUD操作
- ✅ 产品线管理
- ✅ 人员管理
- ✅ 时间范围设置（3个月/半年/一年/自定义）
- ✅ 看板类型切换（按状态/按产品线/按负责人）

### 2.2 现有UI布局

```
┌─────────────────────────────────────────────────┐
│ Header: 项目路线图工具          [新建项目]      │
├──────────┬──────────────────────────────────────┤
│ 左侧面板 │ 右侧时间轴视图（甘特图）              │
│          │                                      │
│ - 产品线 │ ┌──────────────────────────────────┐ │
│   设置   │ │ 时间轴头部（月份/周刻度）         │ │
│          │ ├──────────────────────────────────┤ │
│ - 时间轴 │ │ 泳道1: 项目块1  项目块2          │ │
│   设置   │ │ 泳道2: 项目块3                   │ │
│          │ │ ...                              │ │
│ - 状态   │ └──────────────────────────────────┘ │
│   图例   │                                      │
└──────────┴──────────────────────────────────────┘
```

## 三、需求理解与分析

### 3.1 功能需求拆解

**核心需求**：
1. **日历视图展示**
   - 展示月份日历（类似日历控件的月视图）
   - 显示当前月的所有日期（1-31号）
   - 每个日期格子显示当天上线的项目名称

2. **月份切换**
   - 提供上一月/下一月切换按钮
   - 默认显示当前月份
   - 显示当前选中的年月

3. **项目展示规则**
   - 根据项目的`endDate`（结束时间）确定显示位置
   - 在对应日期下显示项目名称
   - 一个日期可能有多个项目上线

### 3.2 UI设计思路

**方案1：独立日历看板页面**
- 新增一个独立的日历视图组件
- 与现有时间轴视图并列，通过Tab切换
- 优点：独立清晰，不影响现有功能
- 缺点：需要切换视图才能看到

**方案2：侧边栏日历面板**
- 在左侧设置面板下方增加日历面板
- 与时间轴视图同时显示
- 优点：可同时查看两种视图
- 缺点：左侧面板可能过长

**方案3：顶部Tab切换**
- 在右侧内容区域增加Tab切换（时间轴/日历）
- 两种视图互斥显示
- 优点：空间利用充分，视图清晰
- 缺点：需要切换才能看到另一个视图

### 3.3 日历布局设计

```
┌─────────────────────────────────────────────────┐
│ 2025年10月          [<] [今天] [>]              │
├──────┬──────┬──────┬──────┬──────┬──────┬──────┤
│ 周日 │ 周一 │ 周二 │ 周三 │ 周四 │ 周五 │ 周六 │
├──────┼──────┼──────┼──────┼──────┼──────┼──────┤
│      │      │  1   │  2   │  3   │  4   │  5   │
│      │      │      │      │      │      │      │
├──────┼──────┼──────┼──────┼──────┼──────┼──────┤
│  6   │  7   │  8   │  9   │ 10   │ 11   │ 12   │
│      │      │      │      │项目A │      │      │
│      │      │      │      │项目B │      │      │
├──────┼──────┼──────┼──────┼──────┼──────┼──────┤
│ ...  │      │      │      │      │      │      │
└──────┴──────┴──────┴──────┴──────┴──────┴──────┘
```

### 3.4 技术实现要点

1. **日期计算**
   - 使用dayjs处理日期计算
   - 计算每月第一天是星期几
   - 计算每月有多少天
   - 处理跨月显示（上月末尾+下月开头）

2. **项目筛选**
   - 根据当前选中月份筛选项目
   - 按endDate分组项目
   - 考虑产品线筛选和看板类型

3. **交互设计**
   - 点击项目名称可编辑项目
   - 点击日期可创建新项目（endDate预设为该日期）
   - 今天日期高亮显示
   - 有项目的日期特殊标记

## 四、边界确认

### 4.1 功能边界

**包含**：
- ✅ 月视图日历展示
- ✅ 月份切换（上一月/下一月/今天）
- ✅ 按项目结束日期显示项目
- ✅ 点击项目可编辑
- ✅ 响应产品线筛选设置
- ✅ 响应看板类型设置

**不包含**：
- ❌ 周视图/年视图
- ❌ 日程拖拽调整
- ❌ 项目开始日期显示
- ❌ 跨日期项目展示（只显示结束日期）

### 4.2 数据边界

- 使用现有项目数据，无需新增字段
- 只读取endDate字段确定显示位置
- 遵循现有的产品线筛选和看板类型设置

### 4.3 UI边界

- 日历格子大小自适应容器宽度
- 每个日期格子最多显示5个项目（超出显示"+N"）
- 项目名称过长时截断显示（hover显示完整名称）

## 五、疑问与决策点

### 5.1 需要确认的问题

1. **视图切换方式**
   - ❓ 采用哪种方案？（独立页面/侧边栏/Tab切换）
   - 建议：**Tab切换方案**，在右侧内容区域增加"时间轴"和"日历"两个Tab

2. **项目显示规则**
   - ❓ 一个日期有多个项目时如何显示？
   - 建议：垂直堆叠显示，最多显示5个，超出显示"+N更多"

3. **项目颜色规则**
   - ❓ 日历中的项目是否需要颜色区分？
   - 建议：使用现有的状态颜色或负责人颜色（根据看板类型）

4. **筛选联动**
   - ❓ 日历视图是否响应产品线筛选？
   - 建议：是，与时间轴视图保持一致

5. **空日期处理**
   - ❓ 没有项目的日期如何显示？
   - 建议：显示为空白格子，可点击创建新项目

### 5.2 技术决策

1. **组件结构**
   ```
   CalendarView.jsx          # 日历视图主组件
   ├── CalendarHeader.jsx    # 日历头部（年月+切换按钮）
   ├── CalendarGrid.jsx      # 日历网格
   └── CalendarCell.jsx      # 日历单元格（单个日期）
   ```

2. **状态管理**
   - 在App.jsx中增加`viewType`状态（'timeline' | 'calendar'）
   - 日历当前月份状态（默认当前月）
   - 复用现有的项目、产品线、看板类型状态

3. **样式设计**
   - 使用CSS Grid布局日历网格（7列）
   - 响应式设计，适配不同屏幕尺寸
   - 复用现有的颜色系统和主题

## 六、实现约束

### 6.1 技术约束

- 必须使用React + Ant Design组件库
- 必须使用dayjs处理日期
- 必须复用现有的API和数据模型
- 必须保持代码风格一致

### 6.2 兼容性约束

- 不能破坏现有时间轴功能
- 必须响应现有的筛选和设置
- 必须支持现有的项目编辑流程

### 6.3 性能约束

- 日历渲染性能优化（避免不必要的重渲染）
- 大量项目时的显示优化
- 月份切换流畅无卡顿

## 七、下一步行动

1. ✅ 完成需求对齐文档
2. ⏳ 等待用户确认以下决策点：
   - 视图切换方式（建议Tab切换）
   - 项目显示规则（建议垂直堆叠，最多5个）
   - 项目颜色规则（建议使用状态/负责人颜色）
3. ⏳ 进入Architect阶段，设计详细架构
4. ⏳ 进入Atomize阶段，拆分实现任务

## 八、参考资料

- 现有项目文档：`docs/项目路线图工具/`
- 时间轴组件：`frontend/src/components/Timeline/`
- 日期工具：`frontend/src/utils/dateUtils.js`
- Ant Design Calendar组件：https://ant.design/components/calendar-cn/

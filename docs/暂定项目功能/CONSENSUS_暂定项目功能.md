# 暂定项目功能 - 需求共识文档

## 一、需求确认

基于 ALIGNMENT 文档的分析，我们达成以下共识：

### 1.1 核心需求

1. **新增暂定字段**：在项目模型中增加 `isPending` 布尔字段
2. **表单增强**：项目表单增加暂定复选框，默认不勾选
3. **视觉区分**：暂定项目使用虚线边框，填充颜色保持现有规则
4. **逻辑调整**：暂停状态不再使用虚线边框（改为实线）

### 1.2 技术实现方案

#### 后端改动

**文件**：`backend/models/project.py`
- 在 `__init__` 方法中增加 `isPending` 参数，默认值 `False`
- 在 `to_dict` 方法中输出 `isPending` 字段
- 在 `from_dict` 方法中读取 `isPending` 字段（兼容旧数据）
- 在 `update` 方法的 `allowed_fields` 中增加 `isPending`
- 不需要验证逻辑（布尔值无需验证）

#### 前端改动

**文件1**：`frontend/src/components/ProjectModal.jsx`
- 在表单中增加暂定复选框（Checkbox）
- 位置：项目状态字段之后
- 标签：「暂定」
- 默认值：false
- 编辑模式正确回显
- 提交时包含该字段

**文件2**：`frontend/src/components/Timeline/ProjectBar.jsx`
- 修改虚线边框逻辑：
  - 原逻辑：`isPaused` 决定虚线
  - 新逻辑：`isPending` 决定虚线
- 保持填充颜色逻辑不变
- 暂停状态不再特殊处理边框样式

### 1.3 验收标准

#### 后端验收
- ✅ 项目模型包含 `isPending` 字段
- ✅ 创建项目时可设置 `isPending`
- ✅ 更新项目时可修改 `isPending`
- ✅ 查询项目时返回 `isPending`
- ✅ 旧数据兼容（默认 false）

#### 前端验收
- ✅ 新建项目表单显示暂定复选框，默认不勾选
- ✅ 编辑项目表单显示暂定复选框，正确回显
- ✅ 提交表单包含 `isPending` 字段
- ✅ 暂定项目在进度看板显示虚线边框
- ✅ 暂定项目在人员看板显示虚线边框
- ✅ 暂定项目填充颜色按现有规则
- ✅ 暂停状态项目显示实线边框
- ✅ 暂定且暂停的项目显示虚线边框

## 二、技术方案详细说明

### 2.1 数据模型变更

#### 字段定义
```python
isPending: bool  # 是否暂定，默认 False
```

#### 数据示例
```json
{
  "id": "proj-xxx",
  "name": "示例项目",
  "productLineId": "pl-xxx",
  "ownerId": "owner-xxx",
  "startDate": "2025-01-01",
  "endDate": "2025-03-31",
  "status": "开发",
  "isPending": true,
  "createdAt": 1704067200000,
  "updatedAt": 1704067200000
}
```

### 2.2 前端表单设计

#### 表单布局
```
项目名称: [输入框]
产品线: [下拉选择]
项目负责人: [下拉选择]
开始日期: [日期选择]
结束日期: [日期选择]
项目状态: [下拉选择]
暂定: [复选框] ← 新增
```

#### 复选框配置
- 组件：Ant Design Checkbox
- 标签：「暂定」
- 提示：无（字段含义明确）
- 默认值：false
- 验证：无需验证

### 2.3 视觉展示逻辑

#### 边框样式决策树
```
if (project.isPending) {
  borderStyle = 'dashed'  // 虚线
} else {
  borderStyle = 'solid'   // 实线
}
```

#### 填充颜色决策树（保持不变）
```
if (boardType === BOARD_TYPES.OWNER) {
  // 人员看板：使用人员颜色
  color = owner.color
} else {
  // 进度看板：使用状态颜色
  color = STATUS_COLORS[project.status]
}

// 暂停状态特殊处理填充色
if (project.status === '暂停') {
  backgroundColor = '#f5f5f5'  // 浅灰色
} else {
  backgroundColor = color
}
```

### 2.4 兼容性处理

#### 后端兼容
```python
# from_dict 方法
isPending=data.get('isPending', False)  # 默认 False
```

#### 前端兼容
```javascript
// 读取项目数据时
const isPending = project.isPending || false
```

## 三、实现约束

### 3.1 代码规范
- 遵循现有代码风格
- 函数和类添加完整注释
- 变量命名清晰明确

### 3.2 测试要求
- 手动测试所有场景
- 验证新建、编辑、显示功能
- 验证两种看板的显示效果
- 验证旧数据兼容性

### 3.3 文档要求
- 更新 README.md（如需要）
- 创建完整的任务文档
- 记录验收结果

## 四、风险评估

### 4.1 技术风险
- **风险等级**：低
- **原因**：改动范围小，逻辑简单
- **缓解措施**：充分测试

### 4.2 兼容性风险
- **风险等级**：低
- **原因**：使用默认值处理旧数据
- **缓解措施**：验证旧数据显示正常

### 4.3 用户体验风险
- **风险等级**：极低
- **原因**：新增功能，不影响现有使用
- **缓解措施**：默认不勾选，不改变现有行为

## 五、实施计划

### 5.1 开发顺序
1. 后端模型修改（基础）
2. 前端表单修改（输入）
3. 前端显示修改（输出）
4. 集成测试（验证）

### 5.2 测试场景
1. 新建暂定项目
2. 编辑项目设置暂定
3. 编辑项目取消暂定
4. 暂定项目在进度看板显示
5. 暂定项目在人员看板显示
6. 暂停状态项目显示（实线）
7. 暂定且暂停项目显示（虚线）
8. 旧数据显示（默认不暂定）

## 六、最终确认清单

### 6.1 需求确认
- ✅ 需求边界清晰
- ✅ 技术方案可行
- ✅ 验收标准明确
- ✅ 无遗留疑问

### 6.2 技术确认
- ✅ 架构设计合理
- ✅ 实现方案具体
- ✅ 兼容性处理完善
- ✅ 风险可控

### 6.3 质量确认
- ✅ 代码规范明确
- ✅ 测试场景完整
- ✅ 文档要求清晰

## 七、下一步行动

1. 创建 DESIGN 文档，详细设计系统架构
2. 创建 TASK 文档，拆分原子任务
3. 等待人工审批
4. 开始实施

## 八、文档版本

- **创建时间**：2025-10-20
- **创建人**：Cline AI
- **版本**：v1.0
- **状态**：待审核
- **依赖文档**：ALIGNMENT_暂定项目功能.md

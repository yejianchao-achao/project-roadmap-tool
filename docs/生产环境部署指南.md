# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

**ç›®æ ‡æœåŠ¡å™¨**: 10.0.20.178  
**éƒ¨ç½²æ–¹å¼**: SSHè¿œç¨‹éƒ¨ç½²  
**é¡¹ç›®ç±»å‹**: React + Flask å…¨æ ˆåº”ç”¨  
**éƒ¨ç½²æ—¶é—´**: 2025å¹´10æœˆ25æ—¥

---

## ğŸ¯ éƒ¨ç½²å‰å‡†å¤‡

### 1. æœ¬åœ°ç¯å¢ƒç¡®è®¤

#### 1.1 SSHå¯†é’¥é…ç½®
- âœ… ç”Ÿäº§ç¯å¢ƒå·²ä¸Šä¼ å…¬é’¥
- âœ… æœ¬åœ°å·²æœ‰è®¿é—®ç§é’¥
- æµ‹è¯•SSHè¿æ¥ï¼š
```bash
ssh -i /path/to/your/private_key user@10.0.20.178
```

#### 1.2 æœ¬åœ°é¡¹ç›®æ‰“åŒ…
åœ¨æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

```bash
# 1. æ„å»ºå‰ç«¯ç”Ÿäº§ç‰ˆæœ¬
cd frontend
npm run build

# 2. è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..
```

---

## ğŸ“¦ éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶ï¼ˆå¿…é¡»ä¸Šä¼ ï¼‰

#### 1. åç«¯æ–‡ä»¶
```
backend/
â”œâ”€â”€ app.py                    # Flaskåº”ç”¨å…¥å£
â”œâ”€â”€ requirements.txt          # Pythonä¾èµ–
â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ owner.py
â”‚   â”œâ”€â”€ productline.py
â”‚   â”œâ”€â”€ project.py
â”‚   â””â”€â”€ settings.py
â”œâ”€â”€ routes/                   # APIè·¯ç”±
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ owners.py
â”‚   â”œâ”€â”€ productlines.py
â”‚   â”œâ”€â”€ projects.py
â”‚   â””â”€â”€ settings.py
â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ owner_service.py
â”‚   â”œâ”€â”€ productline_service.py
â”‚   â”œâ”€â”€ project_service.py
â”‚   â””â”€â”€ settings_service.py
â””â”€â”€ utils/                    # å·¥å…·å‡½æ•°
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ decorators.py
    â”œâ”€â”€ file_handler.py
    â””â”€â”€ migrate_owners.py
```

#### 2. å‰ç«¯æ„å»ºäº§ç‰©
```
frontend/dist/               # npm run build ç”Ÿæˆçš„æ„å»ºäº§ç‰©
â”œâ”€â”€ index.html
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ index-[hash].js
â”‚   â”œâ”€â”€ index-[hash].css
â”‚   â””â”€â”€ ...
```

#### 3. æ•°æ®ç›®å½•ï¼ˆåˆå§‹åŒ–ï¼‰
```
data/
â”œâ”€â”€ projects.json            # é¡¹ç›®æ•°æ®ï¼ˆå¯é€‰ï¼Œé¦–æ¬¡å¯ä¸ºç©ºæ•°ç»„ï¼‰
â”œâ”€â”€ productlines.json        # äº§å“çº¿æ•°æ®ï¼ˆå¯é€‰ï¼Œé¦–æ¬¡å¯ä¸ºç©ºæ•°ç»„ï¼‰
â”œâ”€â”€ owners.json              # è´Ÿè´£äººæ•°æ®ï¼ˆå¯é€‰ï¼Œé¦–æ¬¡å¯ä¸ºç©ºæ•°ç»„ï¼‰
â””â”€â”€ settings.json            # è®¾ç½®æ•°æ®ï¼ˆå¯é€‰ï¼Œé¦–æ¬¡å¯ä¸ºç©ºå¯¹è±¡ï¼‰
```

#### 4. é…ç½®æ–‡ä»¶
```
.gitignore                   # Gitå¿½ç•¥é…ç½®
README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

### ä¸éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶

```
âŒ node_modules/            # npmä¾èµ–ï¼ŒæœåŠ¡å™¨ç«¯ä¸éœ€è¦
âŒ frontend/src/            # å‰ç«¯æºç ï¼Œå·²æ„å»º
âŒ frontend/package*.json   # å‰ç«¯ä¾èµ–é…ç½®ï¼Œå·²æ„å»º
âŒ frontend/vite.config.js  # Viteé…ç½®ï¼Œå·²æ„å»º
âŒ .git/                    # Gitä»“åº“
âŒ docs/                    # å¼€å‘æ–‡æ¡£
âŒ data_backup/             # å¤‡ä»½æ•°æ®
âŒ å¯åŠ¨é¡¹ç›®.command         # macOSå¯åŠ¨è„šæœ¬
âŒ start.py                 # å¼€å‘å¯åŠ¨è„šæœ¬
âŒ __pycache__/             # Pythonç¼“å­˜
âŒ *.pyc                    # Pythonç¼–è¯‘æ–‡ä»¶
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1: æœ¬åœ°æ„å»ºå‰ç«¯

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cd frontend
npm run build
cd ..
```

æ„å»ºå®Œæˆåï¼Œ`frontend/dist/` ç›®å½•åŒ…å«ç”Ÿäº§ç‰ˆæœ¬çš„å‰ç«¯æ–‡ä»¶ã€‚

### æ­¥éª¤2: åˆ›å»ºéƒ¨ç½²åŒ…

```bash
# åˆ›å»ºä¸´æ—¶éƒ¨ç½²ç›®å½•
mkdir -p ~/deploy_temp/project-roadmap

# å¤åˆ¶åç«¯æ–‡ä»¶
cp -r backend ~/deploy_temp/project-roadmap/

# å¤åˆ¶å‰ç«¯æ„å»ºäº§ç‰©
cp -r frontend/dist ~/deploy_temp/project-roadmap/frontend_dist

# å¤åˆ¶é…ç½®æ–‡ä»¶
cp .gitignore ~/deploy_temp/project-roadmap/
cp README.md ~/deploy_temp/project-roadmap/

# åˆ›å»ºæ•°æ®ç›®å½•ï¼ˆåˆå§‹åŒ–ç©ºæ•°æ®ï¼‰
mkdir -p ~/deploy_temp/project-roadmap/data
echo '[]' > ~/deploy_temp/project-roadmap/data/projects.json
echo '[]' > ~/deploy_temp/project-roadmap/data/productlines.json
echo '[]' > ~/deploy_temp/project-roadmap/data/owners.json
echo '{}' > ~/deploy_temp/project-roadmap/data/settings.json
```

### æ­¥éª¤3: ä¸Šä¼ åˆ°ç”Ÿäº§æœåŠ¡å™¨

```bash
# ä½¿ç”¨rsyncä¸Šä¼ ï¼ˆæ¨èï¼Œæ”¯æŒå¢é‡åŒæ­¥ï¼‰
rsync -avz --progress \
  -e "ssh -i /path/to/your/private_key" \
  ~/deploy_temp/project-roadmap/ \
  user@10.0.20.178:/path/to/deployment/directory/

# æˆ–ä½¿ç”¨scpä¸Šä¼ 
scp -i /path/to/your/private_key -r \
  ~/deploy_temp/project-roadmap \
  user@10.0.20.178:/path/to/deployment/directory/
```

**æ³¨æ„**: 
- æ›¿æ¢ `/path/to/your/private_key` ä¸ºå®é™…ç§é’¥è·¯å¾„
- æ›¿æ¢ `user` ä¸ºå®é™…ç”¨æˆ·å
- æ›¿æ¢ `/path/to/deployment/directory/` ä¸ºæœåŠ¡å™¨éƒ¨ç½²ç›®å½•

### æ­¥éª¤4: æœåŠ¡å™¨ç«¯é…ç½®

SSHç™»å½•åˆ°ç”Ÿäº§æœåŠ¡å™¨ï¼š

```bash
ssh -i /path/to/your/private_key user@10.0.20.178
```

#### 4.1 å®‰è£…Pythonä¾èµ–

```bash
cd /path/to/deployment/directory/project-roadmap

# åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r backend/requirements.txt
```

#### 4.2 é…ç½®Nginxï¼ˆæ¨èï¼‰

åˆ›å»ºNginxé…ç½®æ–‡ä»¶ `/etc/nginx/sites-available/project-roadmap`:

```nginx
server {
    listen 80;
    server_name 10.0.20.178;  # æˆ–ä½¿ç”¨åŸŸå

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /path/to/deployment/directory/project-roadmap/frontend_dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # åç«¯APIä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        root /path/to/deployment/directory/project-roadmap/frontend_dist;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

å¯ç”¨é…ç½®ï¼š

```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/project-roadmap /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

#### 4.3 é…ç½®Flaskåç«¯æœåŠ¡

åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/project-roadmap.service`:

```ini
[Unit]
Description=Project Roadmap Flask Backend
After=network.target

[Service]
Type=simple
User=your_user
WorkingDirectory=/path/to/deployment/directory/project-roadmap
Environment="PATH=/path/to/deployment/directory/project-roadmap/venv/bin"
ExecStart=/path/to/deployment/directory/project-roadmap/venv/bin/python backend/app.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
# é‡è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start project-roadmap

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable project-roadmap

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status project-roadmap
```

---

## ğŸ”§ ç”Ÿäº§ç¯å¢ƒé…ç½®è°ƒæ•´

### 1. Flaské…ç½®ï¼ˆbackend/app.pyï¼‰

ä¿®æ”¹Flaskåº”ç”¨é…ç½®ä¸ºç”Ÿäº§æ¨¡å¼ï¼š

```python
if __name__ == '__main__':
    # ç”Ÿäº§ç¯å¢ƒé…ç½®
    app.run(
        host='127.0.0.1',  # ä»…ç›‘å¬æœ¬åœ°ï¼Œé€šè¿‡Nginxä»£ç†
        port=5000,
        debug=False,       # å…³é—­è°ƒè¯•æ¨¡å¼
        threaded=True      # å¯ç”¨å¤šçº¿ç¨‹
    )
```

### 2. CORSé…ç½®

å¦‚æœå‰åç«¯åœ¨åŒä¸€åŸŸåä¸‹ï¼ˆé€šè¿‡Nginxä»£ç†ï¼‰ï¼Œå¯ä»¥é™åˆ¶CORSï¼š

```python
from flask_cors import CORS

# é™åˆ¶CORSæ¥æº
CORS(app, resources={
    r"/api/*": {
        "origins": ["http://10.0.20.178", "https://your-domain.com"]
    }
})
```

### 3. æ•°æ®ç›®å½•æƒé™

```bash
# ç¡®ä¿æ•°æ®ç›®å½•æœ‰æ­£ç¡®çš„æƒé™
chmod 755 /path/to/deployment/directory/project-roadmap/data
chmod 644 /path/to/deployment/directory/project-roadmap/data/*.json
```

---

## âœ… éƒ¨ç½²éªŒè¯

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥Flaskåç«¯
sudo systemctl status project-roadmap

# æ£€æŸ¥Nginx
sudo systemctl status nginx

# æŸ¥çœ‹Flaskæ—¥å¿—
sudo journalctl -u project-roadmap -f
```

### 2. æµ‹è¯•APIæ¥å£

```bash
# æµ‹è¯•äº§å“çº¿API
curl http://10.0.20.178/api/productlines

# æµ‹è¯•é¡¹ç›®API
curl http://10.0.20.178/api/projects

# æµ‹è¯•è®¾ç½®API
curl http://10.0.20.178/api/settings
```

### 3. æµè§ˆå™¨è®¿é—®

æ‰“å¼€æµè§ˆå™¨è®¿é—®: `http://10.0.20.178`

éªŒè¯åŠŸèƒ½ï¼š
- âœ… é¡µé¢æ­£å¸¸åŠ è½½
- âœ… å¯ä»¥åˆ›å»ºäº§å“çº¿
- âœ… å¯ä»¥åˆ›å»ºé¡¹ç›®
- âœ… æ—¶é—´è½´æ­£å¸¸æ˜¾ç¤º
- âœ… è®¾ç½®å¯ä»¥ä¿å­˜

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²æµç¨‹

åç»­æ›´æ–°æ—¶ï¼Œåªéœ€æ‰§è¡Œï¼š

```bash
# 1. æœ¬åœ°æ„å»º
cd frontend && npm run build && cd ..

# 2. ä¸Šä¼ æ›´æ–°
rsync -avz --progress \
  -e "ssh -i /path/to/your/private_key" \
  --exclude='data/' \
  ~/deploy_temp/project-roadmap/ \
  user@10.0.20.178:/path/to/deployment/directory/

# 3. é‡å¯æœåŠ¡
ssh -i /path/to/your/private_key user@10.0.20.178 \
  "sudo systemctl restart project-roadmap"
```

**æ³¨æ„**: `--exclude='data/'` é¿å…è¦†ç›–ç”Ÿäº§æ•°æ®

---

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

### 1. é˜²ç«å¢™é…ç½®

```bash
# åªå¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp  # SSH
sudo ufw enable
```

### 2. HTTPSé…ç½®ï¼ˆæ¨èï¼‰

ä½¿ç”¨Let's Encryptå…è´¹SSLè¯ä¹¦ï¼š

```bash
# å®‰è£…certbot
sudo apt install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

### 3. æ•°æ®å¤‡ä»½

åˆ›å»ºå®šæ—¶å¤‡ä»½è„šæœ¬ `/usr/local/bin/backup-roadmap.sh`:

```bash
#!/bin/bash
BACKUP_DIR="/backup/project-roadmap"
DATA_DIR="/path/to/deployment/directory/project-roadmap/data"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR
tar -czf $BACKUP_DIR/data_$DATE.tar.gz -C $DATA_DIR .

# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "data_*.tar.gz" -mtime +7 -delete
```

æ·»åŠ åˆ°crontabï¼š

```bash
# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /usr/local/bin/backup-roadmap.sh
```

---

## ğŸ“Š ç›‘æ§å»ºè®®

### 1. æ—¥å¿—ç›‘æ§

```bash
# å®æ—¶æŸ¥çœ‹Flaskæ—¥å¿—
sudo journalctl -u project-roadmap -f

# æŸ¥çœ‹Nginxè®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/access.log

# æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### 2. æ€§èƒ½ç›‘æ§

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š
- **htop**: ç³»ç»Ÿèµ„æºç›‘æ§
- **netdata**: å®æ—¶æ€§èƒ½ç›‘æ§
- **prometheus + grafana**: ä¸“ä¸šç›‘æ§æ–¹æ¡ˆ

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: 502 Bad Gateway

**åŸå› **: Flaskåç«¯æœªå¯åŠ¨æˆ–ç«¯å£ä¸é€š

**è§£å†³**:
```bash
# æ£€æŸ¥FlaskæœåŠ¡çŠ¶æ€
sudo systemctl status project-roadmap

# é‡å¯æœåŠ¡
sudo systemctl restart project-roadmap

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 5000
```

### é—®é¢˜2: é™æ€æ–‡ä»¶404

**åŸå› **: Nginxé…ç½®è·¯å¾„é”™è¯¯

**è§£å†³**:
```bash
# æ£€æŸ¥å‰ç«¯æ–‡ä»¶è·¯å¾„
ls -la /path/to/deployment/directory/project-roadmap/frontend_dist/

# æ£€æŸ¥Nginxé…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

### é—®é¢˜3: APIè¯·æ±‚è·¨åŸŸé”™è¯¯

**åŸå› **: CORSé…ç½®é—®é¢˜

**è§£å†³**: æ£€æŸ¥Flaskçš„CORSé…ç½®ï¼Œç¡®ä¿å…è®¸å‰ç«¯åŸŸå

### é—®é¢˜4: æ•°æ®æ— æ³•ä¿å­˜

**åŸå› **: æ–‡ä»¶æƒé™é—®é¢˜

**è§£å†³**:
```bash
# æ£€æŸ¥dataç›®å½•æƒé™
ls -la /path/to/deployment/directory/project-roadmap/data/

# ä¿®æ”¹æƒé™
sudo chown -R your_user:your_user /path/to/deployment/directory/project-roadmap/data/
chmod 755 /path/to/deployment/directory/project-roadmap/data/
chmod 644 /path/to/deployment/directory/project-roadmap/data/*.json
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **ç³»ç»Ÿæ—¥å¿—**: `sudo journalctl -u project-roadmap -n 100`
2. **Nginxæ—¥å¿—**: `/var/log/nginx/error.log`
3. **æ–‡ä»¶æƒé™**: `ls -la` æ£€æŸ¥å…³é”®ç›®å½•
4. **ç«¯å£å ç”¨**: `sudo netstat -tlnp`
5. **é˜²ç«å¢™è§„åˆ™**: `sudo ufw status`

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·ç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] SSHè¿æ¥æ­£å¸¸
- [ ] å‰ç«¯æ„å»ºå®Œæˆï¼ˆfrontend/distå­˜åœ¨ï¼‰
- [ ] æ‰€æœ‰å¿…è¦æ–‡ä»¶å·²ä¸Šä¼ 
- [ ] Pythonä¾èµ–å·²å®‰è£…
- [ ] FlaskæœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] Nginxé…ç½®æ­£ç¡®
- [ ] å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®
- [ ] APIæ¥å£å“åº”æ­£å¸¸
- [ ] æ•°æ®å¯ä»¥æ­£å¸¸ä¿å­˜
- [ ] é˜²ç«å¢™è§„åˆ™é…ç½®
- [ ] å¤‡ä»½è„šæœ¬é…ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] HTTPSè¯ä¹¦é…ç½®ï¼ˆå¯é€‰ï¼‰

---

**éƒ¨ç½²å®Œæˆï¼** ğŸ‰

é¡¹ç›®å·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ `10.0.20.178`

# 对齐文档 - 项目路线图工具

## 1. 原始需求

构建一个基于Web的项目路线图可视化管理工具，支持：
- 项目的创建、编辑、删除
- 时间轴可视化展示
- 按产品线分组展示
- 本地数据持久化
- 一键启动脚本

## 2. 项目上下文分析

### 2.1 当前项目状态
- 全新项目，无现有代码库
- 工作目录：`/Users/a1/Desktop/个人/项目路线图`
- 目标平台：macOS
- 部署方式：本地运行

### 2.2 技术栈决策

#### 前端技术栈
- **UI框架**: React + Ant Design 5.0
- **状态管理**: React Hooks (useState, useEffect)
- **时间处理**: dayjs (Ant Design推荐)
- **构建工具**: Vite (快速开发体验)

#### 后端技术栈
- **Web框架**: Flask (轻量级，适合本地应用)
- **数据存储**: JSON文件 (简单持久化)
- **API设计**: RESTful API

#### 部署方案
- Python脚本一键启动前后端
- 前端：静态文件服务
- 后端：Flask开发服务器
- 数据：本地JSON文件

## 3. 需求理解与规范

### 3.1 数据模型

#### 产品线 (ProductLine)
```json
{
  "id": "string (UUID)",
  "name": "string",
  "createdAt": "timestamp"
}
```

#### 项目 (Project)
```json
{
  "id": "string (UUID)",
  "name": "string",
  "productLineId": "string",
  "startDate": "string (YYYY-MM-DD)",
  "endDate": "string (YYYY-MM-DD)",
  "status": "enum (规划|方案|设计|开发|测试|已上|暂停)",
  "createdAt": "timestamp",
  "updatedAt": "timestamp"
}
```

### 3.2 功能规范

#### F1: 项目创建
- **输入验证**:
  - 项目名称：必填，非空字符串
  - 产品线：必选，可新建
  - 开始日期：必填，日期格式
  - 截止日期：必填，必须 >= 开始日期
  - 状态：必选，7个状态之一

#### F2: 项目编辑
- 支持修改所有字段
- 保持数据验证规则
- 支持删除操作（需确认）

#### F3: 时间轴可视化
- **时间轴特性**:
  - 顶部：月份刻度
  - 背景：周刻度网格
  - 支持水平滚动
  - 自动计算显示范围（所有项目的最早到最晚）

- **项目块渲染**:
  - 长度：按实际时间跨度计算
  - 位置：精确对应时间轴位置
  - 颜色：按状态映射
  - 排列：同产品线内智能避免重叠

- **产品线泳道**:
  - 按产品线分组
  - 支持多选显示/隐藏
  - 每个泳道独立计算行数

### 3.3 状态颜色映射
```javascript
const STATUS_COLORS = {
  '规划': '#87CEEB',  // 浅蓝色
  '方案': '#4169E1',  // 蓝色
  '设计': '#32CD32',  // 绿色
  '开发': '#FF8C00',  // 橙色
  '测试': '#FFD700',  // 黄色
  '已上': '#DC143C',  // 深红色
  '暂停': '#808080'   // 灰色（虚线边框）
};
```

## 4. 边界确认

### 4.1 功能边界
- ✅ 单用户本地使用
- ✅ 基础CRUD操作
- ✅ 时间轴可视化
- ❌ 多用户协作
- ❌ 权限管理
- ❌ 数据导入导出
- ❌ 项目依赖关系
- ❌ 甘特图详细视图

### 4.2 技术约束
- 仅支持macOS平台
- 需要Python 3.8+
- 需要Node.js 16+
- 浏览器：现代浏览器（Chrome/Safari/Firefox）

### 4.3 性能要求
- 支持100+项目流畅展示
- 页面加载时间 < 2秒
- 交互响应时间 < 100ms

## 5. 待澄清问题

### Q1: 项目块重叠处理细节
**问题**: 当多个项目时间重叠时，如何精确计算行数和位置？

**确认方案**: 
- 使用区间调度算法
- 同一产品线内，按开始时间排序
- 贪心分配：尽量放在第一行，冲突则放下一行

**状态**: ✅ 已确认

### Q2: 时间轴滚动范围
**问题**: 时间轴的起止范围如何确定？

**确认方案**:
- 最小范围：所有项目的最早开始日期到最晚结束日期
- 额外留白：前后各延伸2个月
- 动态调整：新增项目时自动扩展

**状态**: ✅ 已确认

### Q3: 数据文件位置
**问题**: JSON数据文件存储在哪里？

**确认方案**:
- 存储在项目根目录下的 `data/` 文件夹
- 文件名：`projects.json`, `productlines.json`
- 首次运行自动创建

**状态**: ✅ 已确认

### Q4: 启动脚本功能
**问题**: 一键启动脚本需要包含哪些功能？

**确认方案**:
- 检查依赖（Python、Node.js）
- 自动安装依赖包
- 启动后端服务
- 启动前端开发服务器
- 自动打开浏览器

**状态**: ✅ 已确认

### Q5: 产品线管理
**问题**: 是否需要单独的产品线管理页面？

**确认方案**:
- 不需要独立页面
- 在项目创建/编辑时支持新建产品线
- 在筛选器中显示所有产品线

**状态**: ✅ 已确认

## 6. 技术实现关键点

### 6.1 时间轴渲染算法
```
1. 计算时间范围（最早到最晚 + 留白）
2. 计算像素比例（总宽度 / 总天数）
3. 遍历项目：
   - 计算起始位置 = (开始日期 - 最早日期) * 像素比例
   - 计算宽度 = (结束日期 - 开始日期) * 像素比例
   - 分配行号（避免重叠）
```

### 6.2 重叠检测算法
```
function findAvailableRow(project, existingProjects) {
  let row = 0;
  while (true) {
    const conflicts = existingProjects.filter(p => 
      p.row === row && 
      p.productLineId === project.productLineId &&
      timeRangeOverlap(p, project)
    );
    if (conflicts.length === 0) return row;
    row++;
  }
}
```

## 7. 验收标准

### 7.1 功能验收
- [ ] 可以创建项目，所有字段验证正确
- [ ] 可以编辑项目，修改立即生效
- [ ] 可以删除项目，需要确认
- [ ] 时间轴正确显示月份和周刻度
- [ ] 项目块位置和长度准确对应时间
- [ ] 项目块颜色正确映射状态
- [ ] 重叠项目自动分行显示
- [ ] 产品线筛选功能正常
- [ ] 数据持久化，重启后数据保留

### 7.2 性能验收
- [ ] 50个项目时页面流畅
- [ ] 时间轴滚动无卡顿
- [ ] 项目创建/编辑响应快速

### 7.3 部署验收
- [ ] 启动脚本可以一键运行
- [ ] 自动检查并安装依赖
- [ ] 自动打开浏览器访问应用
- [ ] 数据文件自动创建

## 8. 风险识别

### R1: 时间轴渲染性能
- **风险**: 项目过多时渲染性能下降
- **缓解**: 使用虚拟滚动或分页加载

### R2: 日期计算复杂度
- **风险**: 跨年、跨月计算容易出错
- **缓解**: 使用成熟的日期库（dayjs）

### R3: 数据一致性
- **风险**: 并发修改导致数据丢失
- **缓解**: 单用户场景，风险较低；添加文件锁机制

## 9. 下一步行动

✅ 所有待澄清问题已确认，进入Architect阶段进行详细设计。

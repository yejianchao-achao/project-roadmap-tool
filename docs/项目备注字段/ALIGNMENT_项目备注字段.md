# 项目备注字段 - 对齐文档

## 一、原始需求
项目增加一个备注字段，非必填，涉及新建与编辑页面

## 二、项目上下文分析

### 2.1 现有项目架构
- **技术栈**：
  - 后端：Flask + Python
  - 前端：React + Ant Design + Vite
  - 数据存储：JSON文件存储

### 2.2 现有项目数据模型
当前项目（Project）包含以下字段：
- id: 项目唯一标识符（UUID格式）
- name: 项目名称（必填，最大200字符）
- productLineId: 所属产品线ID（必填）
- ownerId: 项目负责人ID（必填）
- isPending: 是否暂定（可选，默认false）
- startDate: 开始日期（必填，YYYY-MM-DD格式）
- endDate: 结束日期（必填，YYYY-MM-DD格式）
- status: 项目状态（必填，值范围：规划|方案|设计|开发|测试|已上|暂停）
- createdAt: 创建时间戳（毫秒）
- updatedAt: 更新时间戳（毫秒）

### 2.3 涉及的文件
1. **后端模型层**：`backend/models/project.py` - 定义项目数据结构和验证逻辑
2. **后端路由层**：`backend/routes/projects.py` - 处理项目API请求
3. **后端服务层**：`backend/services/project_service.py` - 处理项目业务逻辑
4. **前端组件**：`frontend/src/components/ProjectModal.jsx` - 项目新建/编辑表单

### 2.4 现有代码模式
- 后端使用类模型定义数据结构
- 字段验证在模型的validate()方法中实现
- 前端使用Ant Design的Form组件
- 表单验证使用Form.Item的rules属性

## 三、需求理解

### 3.1 功能需求
1. **字段名称**：备注（remarks）
2. **字段类型**：文本字段
3. **是否必填**：否（非必填字段）
4. **涉及页面**：
   - 新建项目页面（ProjectModal - 创建模式）
   - 编辑项目页面（ProjectModal - 编辑模式）

### 3.2 字段规格（基于项目模式推断）
- **字段标识**：remarks
- **数据类型**：字符串（string）
- **验证规则**：
  - 非必填（可为空）
  - 最大长度建议：500字符（考虑备注的实际使用场景）
  - 允许为空字符串或null
- **显示形式**：多行文本输入框（TextArea）
- **默认值**：空字符串或null

### 3.3 技术约束
1. 保持与现有字段的一致性（命名规范、验证模式）
2. 兼容现有数据（已存在的项目数据可能没有remarks字段）
3. 遵循现有的代码风格和架构模式

## 四、边界确认

### 4.1 任务范围
**包含**：
- ✅ 后端模型添加remarks字段
- ✅ 后端API支持remarks字段的创建和更新
- ✅ 前端表单添加备注输入框
- ✅ 前端表单验证（长度限制）
- ✅ 数据兼容性处理（旧数据没有remarks字段）

**不包含**：
- ❌ 数据迁移脚本（因为remarks非必填，旧数据可以不设置）
- ❌ 备注字段的搜索功能
- ❌ 备注字段的展示优化（在列表或时间轴视图中）
- ❌ 备注字段的历史记录

### 4.2 验收标准
1. 新建项目时可以输入备注（可选）
2. 编辑项目时可以修改备注
3. 备注字段验证：最大500字符
4. 备注为空或未填写时，项目可以正常创建和更新
5. 已存在的项目（没有remarks字段）在编辑时不会出错
6. 备注内容能够正确保存和读取

## 五、疑问澄清

### 5.1 需要确认的问题
以下问题基于现有项目规范和常见实践，我将做出合理决策：

1. **字段命名**：
   - 决策：使用 `remarks` 作为字段名（符合英文命名规范，清晰表达含义）
   - 前端显示：使用 "备注" 作为标签

2. **字段长度限制**：
   - 决策：最大500字符（考虑备注的实际使用场景，既能容纳足够信息，又不会过于冗长）
   - 如需调整可在后续优化

3. **输入控件类型**：
   - 决策：使用TextArea多行文本框（备注通常需要多行输入）
   - 显示行数：4行（可以看到足够内容，又不占用太多空间）

4. **默认值处理**：
   - 决策：默认为空字符串 `""` 或 `None`
   - 后端存储时如果未提供remarks，设置为空字符串

5. **数据兼容性**：
   - 决策：使用 `.get('remarks', '')` 方式读取，兼容旧数据
   - 旧数据在编辑时自动添加remarks字段（值为空字符串）

## 六、技术实现方案（概要）

### 6.1 后端实现
1. **模型层** (`backend/models/project.py`)：
   - 在 `__init__` 方法中添加 `remarks` 参数（默认为空字符串）
   - 在 `validate` 方法中添加remarks验证（非必填，最大500字符）
   - 在 `to_dict` 方法中包含remarks字段
   - 在 `from_dict` 方法中读取remarks字段（使用.get兼容）
   - 在 `update` 方法的allowed_fields中添加remarks

2. **路由层** (`backend/routes/projects.py`)：
   - POST /api/projects：支持接收remarks字段（可选）
   - PUT /api/projects/<id>：支持更新remarks字段

3. **服务层** (`backend/services/project_service.py`)：
   - create方法支持remarks参数
   - update方法支持remarks字段更新

### 6.2 前端实现
1. **组件层** (`frontend/src/components/ProjectModal.jsx`)：
   - 在Form中添加remarks的Form.Item
   - 使用TextArea组件
   - 设置验证规则：非必填，最大500字符
   - 在编辑模式下正确回显remarks值

### 6.3 兼容性处理
- 后端使用 `data.get('remarks', '')` 读取
- 前端使用 `editingProject.remarks || ''` 读取
- 确保旧数据（没有remarks字段）不会导致错误

## 七、实施顺序
1. 后端模型修改（基础数据结构）
2. 后端路由和服务修改（API支持）
3. 前端表单修改（用户界面）
4. 测试验证（创建、编辑、兼容性）

## 八、风险评估
- **风险等级**：低
- **主要风险**：旧数据兼容性
- **应对措施**：使用.get()方法和默认值处理，确保向后兼容

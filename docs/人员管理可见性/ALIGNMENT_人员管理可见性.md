# ALIGNMENT｜人员管理可见性控制

## 1. 项目上下文

当前“项目路线图工具”已具备基本的人员（Owner）管理功能，包括创建、删除和颜色分配。用户可以直接在创建项目时选择负责人，并在看板中查看。

## 2. 需求理解

用户希望在“人员管理”中增加一个“可见性开关”，用于控制某个人员是否在系统中显示。

### 核心需求
1.  **开关控制**：在人员管理列表中，增加一列开关（Switch），控制人员的“显示/隐藏”状态。
2.  **新建项目影响**：当人员被关闭（隐藏）时，新建项目的负责人下拉列表中**不显示**该人员。
3.  **图例影响**：当人员被关闭（隐藏）时，在左侧的时间轴图例（人员图例）中**不显示**该人员。
4.  **项目显示影响**：当人员被关闭（隐藏）时，该人员已关联的项目在时间轴/看板中**不显示**。

### 边界确认
-   **历史数据**：隐藏人员**不会删除**其数据，只是在前端视图中隐藏。
-   **默认状态**：新建人员默认状态为“显示”（True）。
-   **数据持久化**：可见性状态需要保存到 `owners.json` 文件中。
-   **API变更**：需要新增更新人员状态的API接口。

## 3. 智能决策策略

-   **隐藏逻辑**：
    -   前端：通过过滤 `owners` 列表或在组件渲染时判断 `owner.visible` 属性来实现隐藏。
    -   后端：`getOwners` 接口返回所有人员（包含 `visible` 字段），由前端根据场景决定是否过滤。
    -   *理由*：人员管理界面需要显示所有人员以便进行开关操作，而项目表单和看板需要过滤掉不可见人员。因此后端返回全量数据更灵活。

-   **项目隐藏实现**：
    -   在 `Swimlane.jsx`（时间轴泳道）中，过滤项目列表。如果项目的 `ownerId` 对应的 owner 是隐藏状态，则不渲染该项目。

## 4. 关键决策点

-   **Q: 隐藏的人员是否可以被删除？**
    -   A: 删除逻辑保持不变（有关联项目不可删除）。隐藏只是视觉上的屏蔽。

-   **Q: 如果一个项目已经由“隐藏人员”负责，编辑该项目时会发生什么？**
    -   A: 回显时通常需要特殊处理。如果直接过滤下拉框，可能会导致回显ID变为数字或无法显示名称。
    -   *策略*：在编辑项目时，如果当前负责人在列表中（即使是隐藏的），也应该允许显示（或临时追加到列表），或者仅在**新建**时严格过滤。
    -   *修正*：用户要求“新建项目的人员选项，不显示这个人”。对于**编辑**，为了保证数据完整性，如果当前项目负责人是隐藏的，建议依然显示（或标示为“已禁用”），否则用户无法知道当前负责人是谁。但根据用户“新建项目...不显示”的描述，侧重于**新建**。
    -   *最终决策*：编辑时，如果当前负责人是隐藏的，列表中可暂时保留该选项（或仅显示名称但不允许选择其他隐藏人员）。为简化实现，可以在获取列表时，**合并**“可见人员” + “当前项目负责人（即使不可见）”。或者简单点，下拉列表过滤掉 `visible=false`，但如果 `value` 匹配到不可加载的ID，AntD Select会显示ID。
    -   *改进*：ProjectModal 中获取 owners 后，过滤出 visible=true 的。但如果 editingProject 存在且其 ownerId 对应的 owner 是 hidden 的，需要把这个 owner 也加进来（或者不过滤它）。

-   **Q: "这个人已经关联的项目不显示" 是指在所有视图吗？**
    -   A: 用户表述为“这个人已经关联的项目不显示”，暗示是全局隐藏。即只要负责人被隐藏，该项目在进度看板、人员看板中都消失。这符合“软删除”或“存档”该人员工作的意图。

## 5. 最终共识

-   **后端**：Owner模型增加 `visible` 字段。新增 `updateOwner` 接口。
-   **人员管理**：增加开关列，调用 `updateOwner`。
-   **新建/编辑项目**：下拉列表仅显示 `visible=true` 的人员（注：编辑时若当前负责人隐藏，需特殊处理保证回显）。
-   **图例**：仅显示 `visible=true` 的人员。
-   **时间轴/看板**：过滤掉负责人 `visible=false` 的项目。
